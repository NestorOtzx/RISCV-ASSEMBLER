import { BinaryToRiscV } from '../translator';
import { normalizeRegisters } from './test-tools';

describe('BinaryToRiscV R-Type Instructions', () => {
  const cases = [
    ['add x5, x6, x7', '00000000011100110000001010110011'],
    ['add t0, t1, t2', '00000000011100110000001010110011'],
    ['sub x5, x6, x7', '01000000011100110000001010110011'],
    ['sub s0, s1, s2', '01000001001001001000010000110011'],
    ['sll x5, x6, x7', '00000000011100110001001010110011'],
    ['sll a0, a1, a2', '00000000110001011001010100110011'],
    ['slt x5, x6, x7', '00000000011100110010001010110011'],
    ['slt t0, t1, t2', '00000000011100110010001010110011'],
    ['mul x5, x6, x7', '00000010011100110000001010110011'],
    ['mul a0, a1, a2', '00000010110001011000010100110011'],
    ['mulh x5, x6, x7', '00000010011100110001001010110011'],
    ['mulh t0, t1, t2', '00000010011100110001001010110011'],
    ['mulhsu x5, x6, x7', '00000010011100110010001010110011'],
    ['mulhsu s0, s1, s2', '00000011001001001010010000110011'],
    ['mulhu x5, x6, x7', '00000010011100110011001010110011'],
    ['mulhu a0, a1, a2', '00000010110001011011010100110011'],
    ['div x5, x6, x7', '00000010011100110100001010110011'],
    ['div t0, t1, t2', '00000010011100110100001010110011'],
    ['divu x5, x6, x7', '00000010011100110101001010110011'],
    ['divu s0, s1, s2', '00000011001001001101010000110011'],
    ['rem x5, x6, x7', '00000010011100110110001010110011'],
    ['rem a0, a1, a2', '00000010110001011110010100110011'],
    ['remu x5, x6, x7', '00000010011100110111001010110011'],
    ['remu t0, t1, t2', '00000010011100110111001010110011'],
    ['and x5, x6, x7', '00000000011100110111001010110011'],
    ['and s0, s1, s2', '00000001001001001111010000110011'],
    ['or x5, x6, x7', '00000000011100110110001010110011'],
    ['or a0, a1, a2', '00000000110001011110010100110011'],
    ['xor x5, x6, x7', '00000000011100110100001010110011'],
    ['xor t0, t1, t2', '00000000011100110100001010110011'],
    ['srl x5, x6, x7', '00000000011100110101001010110011'],
    ['srl a0, a1, a2', '00000000110001011101010100110011'],
    ['sra x5, x6, x7', '01000000011100110101001010110011'],
    ['sra t0, t1, t2', '01000000011100110101001010110011']
  ];

  for (const [expectedInstruction, binary] of cases) {
    it(`decodes "${binary}" correctly`, () => {
      const result = BinaryToRiscV([binary], 8);
      expect(normalizeRegisters(result.output[0]))
        .toBe(normalizeRegisters(expectedInstruction));
      expect(result.errors.length).toBe(0);
    });
  }
});
